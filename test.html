<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/main.css">
    <title>Cash Flow: 2019-21 Adopted Budget â€” Open Budget Oakland</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.5/d3.min.js"></script>
  </head>
  <body class="flow">
    <div id="wrapper">
      <nav class="main-nav">
        <div class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Open Budget: Oakland</a>
            </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">About<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="what-we-do.html">What and How</a></li>
                    <li><a href="who-we-are.html">Who We Are</a></li>
                    <li><a href="news.html">News</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                  </ul>
                </li>
                <li><a href="/budget-visuals.html">Visualizations</a></li>
                <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Data<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="https://github.com/openoakland/openbudgetoakland/wiki/API-Documentation">Open Budget Oakland API</a></li>
                    <li><a href="https://cao-94612.s3.amazonaws.com/documents/FY-2019-21-Adopted-Budget-Policy-Book-FINAL-WEB-VERSION.pdf">Adopted Budget Policy Book</a></li>
                    <li><a href="http://data.openoakland.org/dataset/city-oakland-budget">Legacy Datasets</a></li>
                  </ul>
                </li>
                <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Resources<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="oakland-budget-101.html">Oakland Budget 101</a></li>
                    <li><a href="tools-projects.html">Tools and Projects</a></li>
                  </ul>
                  <li><a href="feedback.html">Feedback</a></li>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      <div class="container">
        <div class="row">
          <div class="intro col-md-12">
            <h2>Cash Flow: 2019-21 Adopted Budget</h2>
            <p>This diagram depicts the flow of money through Oakland's budget: from revenue sources (on the left), to the General Fund or various non-discretionary funds (in the center), and finally to the various city departments' expenses (on the right).</p>
            <p><em>Mouse over a flow line to highlight it; click on a bar to highlight all its flows.</em></p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-3">
            <h4>Fiscal Year</h4>
            <select class="form-control" id="fy"></select>
          </div>
        </div>
        <div id="sankey">
          <div id="chart"></div>
        </div>
        <h6>Data Source:&nbsp;<a href="https://data.oaklandnet.com/Financial/FY-2019-21-Adopted-Budget/m4jd-q2c4">Oakland's Open Data Platform</a></h6>
        <div id="hover_description"></div>
        <script type="text/javascript">
          var disqus_shortname = 'openbudgetoakland';
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <script src="js/sankey.js" charset="utf-8"></script>
        <script src="js/flow.js" charset="utf-8"></script>
        <script>
          // process filenames to generate display names
          
          datafiles = datafiles.map(function(datafile){
              var nameParts = datafile.filename.slice(0,-4).split("__");
              datafile.displayName = nameParts.join(" ");
              datafile.fy = nameParts[0];
              datafile.type = nameParts[1];
              return datafile;
          });
          datafiles.sort(function(a,b){
            // years in descending order, 
            // types in order of (adjusted, adopted, proposed)
            // (which happens to be ascending)
            var sortYear = d3.descending(a.fy, b.fy);
            var sortType = d3.ascending(a.type, b.type);
            return sortYear !== 0 ? sortYear : sortType;
          });
          
          d3.select("#fy.form-control").selectAll('option')
              .data(datafiles)
              .enter()
              .append('option')
                  .attr('value', function(d){ return d.filename; })
                  .property('selected', function(d,i){ return i == 0;})
                  .text(function(d){return d.displayName;})
                  ;
          
          d3.select("#fy.form-control")
              .on('change', drawFlow)
              ;
          
          // run once to initially populate the chart
          drawFlow();
          
          function drawFlow(){
              // get currently selected value
              var filename = d3.select('#fy.form-control')[0][0].value;
              var fy = filename.split('__')[0];
          
              d3.csv("data/flow/" + filename, function(error, data){
                  if (error) {
                      console.log('error', error);
                      return false;
                  }
                  var final_data = data_wrangle(data, fy);
                  do_with_budget(final_data);
              });
          }
        </script>
      </div>
    </div>
    <div id="wrapper-footer">
      <footer id="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-9">
              <p>Open Budget: Oakland is an open-source project by<a href="http://openoakland.org">OpenOakland</a> to help citizens better understand Oakland's spending and budget process.</p>
              <ul class="list-inline">
                <li><a href="http://openoakland.org"><img src="/images/global/openoakland-logo.png" width="150" alt="OpenOakland"></a></li>
                <li><a href="https://twitter.com/openbudgetoak"><img src="/images/global/twitter-icon.png" alt="twitter"></a></li>
                <li><a href="https://github.com/openoakland/openbudgetoakland"><img src="/images/global/github-icon.png" alt="github"></a></li>
              </ul>
            </div>
            <div class="col-sm-3 col-md-push-3">
              <ul class="list-unstyled">
                <li><a href="who-we-are.html">About the Project</a></li>
                <li><a href="http://www.meetup.com/OpenOakland">Get Involved</a></li>
                <li><a href="feedback.html">Give Feedback</a></li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <link href="https://fonts.googleapis.com/css?family=Arvo:400,700" rel="stylesheet" type="text/css">
  </body>
</html>